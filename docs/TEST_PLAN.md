# Verification Test Plan for ming-drlms v0.3.0

This document outlines the verification test plan for the core functionalities of `ming-drlms` based on the original project requirements for "实验项目5: 进程间通信 (IPC)" and "实验项目6: 网络通信 (Networking)".

## 1. Test Matrix for Direct IPC Communication (实验项目5)

| Test Case ID | Feature Tested (测试功能模块) | Test Scenario (测试场景描述) | Steps to Reproduce (复现步骤) | Expected Result (期望结果) | Actual Result (实际结果) | Status (状态) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| IPC-001 | Direct IPC | A single, simple message is sent and received correctly. | 1. `KEY="0x4c4f4755"` <br> 2. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 3. `ming-drlms ipc send --text "hello world" --key $KEY` <br> 4. `sleep 1 && kill %1` | The file `ipc_out.log` contains "hello world". | Blocked. The entire Direct IPC system is unstable. Testing revealed that IPC components leave zombie processes and corrupted shared memory segments, preventing reliable test execution. | Blocked |
| IPC-002 | Direct IPC | Sender sends multiple messages in a rapid burst. | 1. `KEY="0x4c4f4755"` <br> 2. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 3. `for i in {1..10}; do ming-drlms ipc send --text "message $i" --key $KEY; done` <br> 4. `sleep 1 && kill %1` | `ipc_out.log` contains all 10 messages in order. | Blocked. The entire Direct IPC system is unstable. | Blocked |
| IPC-003 | Direct IPC | Sender sends a large message (8KB). | 1. `KEY="0x4c4f4755"` <br> 2. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 3. `head -c 8192 /dev/zero | tr '\0' 'A' > large_file.txt` <br> 4. `ming-drlms ipc send --file large_file.txt --key $KEY` <br> 5. `sleep 1 && kill %1` | `ipc_out.log` contains the complete 8KB string. | Blocked. The entire Direct IPC system is unstable. | Blocked |
| IPC-004 | Direct IPC | A message with special characters is transferred correctly. | 1. `KEY="0x4c4f4755"` <br> 2. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 3. `ming-drlms ipc send --text "你好, world! !@#$%^&*() שלום" --key $KEY` <br> 4. `sleep 1 && kill %1` | `ipc_out.log` displays the string perfectly. | Blocked. The entire Direct IPC system is unstable. | Blocked |
| IPC-005 | Direct IPC | An entire text file is transferred via IPC. | 1. `KEY="0x4c4f4755"` <br> 2. `echo "file content" > test.txt` <br> 3. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 4. `ming-drlms ipc send --file test.txt --key $KEY` <br> 5. `sleep 1 && kill %1` | `ipc_out.log` contains the exact content of `test.txt`. | Blocked. The entire Direct IPC system is unstable. | Blocked |
| IPC-006 | Direct IPC | Sender attempts to send an empty message. | 1. `KEY="0x4c4f4755"` <br> 2. `ming-drlms ipc tail --key $KEY > ipc_out.log &` <br> 3. `ming-drlms ipc send --text "" --key $KEY` <br> 4. `sleep 1 && kill %1` | `ipc_out.log` should be empty or contain one empty line. | Blocked. The entire Direct IPC system is unstable. | Blocked |
| IPC-007 | Direct IPC | Sender attempts to send an oversized message. | 1. `KEY="0x4c4f4755"` <br> 2. `head -c 20480 /dev/zero | tr '\0' 'B' > oversized.txt` <br> 3. `ming-drlms ipc send --file oversized.txt --key $KEY` | The command should fail with a clear error message. | Blocked. The entire Direct IPC system is unstable. | Blocked |

## 2. Test Matrix for Networking (实验项目6)

| Test Case ID | Feature Tested (测试功能模块) | Test Scenario (测试场景描述) | Steps to Reproduce (复现步骤) | Expected Result (期望结果) | Actual Result (实际结果) | Status (状态) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| NET-001 | User Authentication | A registered user can perform an authenticated action. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add testuser -d server_files -x` <br> 4. `ming-drlms client list --user testuser --password testpass` | The command exits with code 0 and lists no files. | Test failed. The server rejected the freshly created user's credentials, printing "ERR|AUTH|invalid credentials". This confirms a fundamental bug in the user authentication logic. Additionally, the client command still exited with status code 0, incorrectly indicating success. | Fail |
| NET-002 | User Authentication | An authenticated action fails with incorrect credentials. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add testuser -d server_files -x` <br> 4. `ming-drlms client list --user testuser --password wrongpass` | The command exits with a non-zero code and prints an auth error. | Test failed. The command correctly printed "ERR|AUTH|invalid credentials", but exited with status code 0, failing to signal the error. This confirms the exit code bug from NET-001. | Fail |
| NET-003 | File Operations | A logged-in user lists files on the server. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add testuser -d server_files -x` <br> 4. `touch server_files/dummy.txt` <br> 5. `ming-drlms client list --user testuser --password testpass` | The command output includes the name "dummy.txt". | Blocked due to the critical authentication failure discovered in NET-001. All authenticated commands fail. | Blocked |
| NET-004 | File Transfer Integrity | A user uploads a file, and its integrity is maintained. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add testuser -d server_files -x` <br> 4. `echo "upload test" > upload_test.txt` <br> 5. `ming-drlms client upload -f upload_test.txt --user testuser --password testpass` <br> 6. `sha256sum upload_test.txt` and `sha256sum server_files/upload_test.txt` should match. | The file is uploaded successfully and the hashes match. | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
| NET-005 | File Transfer Integrity | A user downloads a file, and its integrity is maintained. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add testuser -d server_files -x` <br> 4. `echo "download test" > server_files/download_test.txt` <br> 5. `ming-drlms client download -f download_test.txt -o downloaded.txt --user testuser --password testpass` <br> 6. `sha256sum server_files/download_test.txt` and `sha256sum downloaded.txt` should match. | The file is downloaded successfully and the hashes match. | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
| NET-006 | Multi-client Concurrency | Server handles three concurrent clients. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo p | ming-drlms user add u1 -x; echo p | ming-drlms user add u2 -x; echo p | ming-drlms user add u3 -x` <br> 4. `ming-drlms client upload ... &` <br> 5. `ming-drlms client list ... &` <br> 6. `ming-drlms client download ... &` <br> 7. `wait` | All commands complete successfully without crashing the server. | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
| NET-007 | Network Logging | A message from `client log` is written to `central.log`. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo "testpass" | ming-drlms user add alice -d server_files -x` <br> 4. `ming-drlms client log "network log test"` <br> 5. `ming-drlms server down` <br> 6. `cat server_files/central.log` | The log file contains "network log test". | Test failed. The authentication for user 'alice' failed (verified in audit log), but the log was written anyway. This is a potential security issue (information leakage) and confirms the auth system is broken. | Fail |
| NET-008 | Network Logging | An audit log is created for a failed auth attempt. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `ming-drlms client list --user no_such_user --password badpass` <br> 4. `ming-drlms server down` <br> 5. `cat server_files/ops_audit.log` | The audit log contains a JSON entry for the failed `LIST` action. | Test passed. The command failed as expected, and the `ops_audit.log` correctly recorded the failed authentication attempt. | Pass |
| SP-001 | Space/Room | A user can subscribe to a room. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo p | ming-drlms user add spaceuser -x` <br> 4. `ming-drlms space join -r test_room --user spaceuser --password p` | The command exits successfully. | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
| SP-002 | Space/Room | A message published to a room is received by a subscriber. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo p | ming-drlms user add u1 -x; echo p | ming-drlms user add u2 -x` <br> 4. `ming-drlms space join -r test_room --user u1 -P p > space_out.log &` <br> 5. `sleep 2` <br> 6. `ming-drlms space send -r test_room -t "hello space" --user u2 -P p` <br> 7. `sleep 1 && kill %1` | `space_out.log` contains "hello space". | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
| SP-003 | Space/Room | A new subscriber can retrieve room history. | 1. `ming-drlms server up -d server_files &` <br> 2. `sleep 2` <br> 3. `echo p | ming-drlms user add histuser -x` <br> 4. `ming-drlms space send -r hist_room -t "msg1" --user histuser -P p` <br> 5. `ming-drlms space history -r hist_room --user histuser -P p` | The command output lists "msg1". | Blocked due to the critical authentication failure discovered in NET-001. | Blocked |
